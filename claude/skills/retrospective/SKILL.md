---
name: retrospective
description: >
  セッションのふりかえりをKPTA形式（Keep/Problem/Try/Action）で実施し、
  Claude Codeのスキル・設定・ツールへの改善提案をRetrospective.mdに記録する。
  「ふりかえり」「レトロスペクティブ」「retrospective」「振り返り」「KPT」「KPTA」
  「今日のセッションを振り返って」「何がうまくいったか確認して」「セッションの改善点を整理して」
  のように使う。セッション終了時に積極的にこのスキルを使って改善サイクルを回す。
context: fork
allowed-tools:
  - Bash
  - Read
  - Write
  - Edit
  - Glob
  - Grep
  - AskUserQuestion
---

# retrospective

セッション中に起きた出来事を振り返り、KPTA形式でまとめる。各項目を「状況・問題・期待・原因・対策・評価」のフォーマットで整理し、Claude Codeのスキル・設定・ツールへの具体的な改善提案を生成する。結果は `Retrospective.md`（プロジェクトルート）に記録する。

**フロー**: セッション内容の整理 → KPTA分析 → 改善提案の生成 → Retrospective.mdに記録

---

## 実行手順

### Step 1: セッション内容を整理する

会話コンテキスト（会話履歴全体）を丁寧に振り返り、このセッションで行われた作業を時系列で整理する。以下の観点でイベントを抽出する:

- **実施したタスク**: 何を依頼され、どう対応したか
- **使ったツール・コマンド**: Bash, gh, git, linter, CLIツールなど
- **うまくいったこと**: スムーズに進んだ作業・判断・アプローチ
- **つまずいたこと**: 試行錯誤が発生した箇所・エラー・誤解・手戻り
- **スキップ・回避したこと**: 本来やるべきだったが省略されたもの

セッション内容のサマリーをユーザーに提示し、漏れや認識のずれがないか確認する:

```
## セッションサマリー

### 実施したこと
- <時系列で箇条書き>

### 気になった点（詳細はKPTA分析で扱う）
- <うまくいかなかった点・試行錯誤が多かった点>
```

---

### Step 2: KPTA分析を実施する

セッションサマリーをもとに、4つの視点で分類する。

#### KPTA の定義

| カテゴリ | 意味 | 着眼点 |
|---|---|---|
| **Keep** | 続けること（増やしていく） | 今後も維持・強化すべき良い習慣・判断・アプローチ |
| **Problem** | 問題点（顕在化する） | 困った・遅れた・誤った・手戻りが発生した原因となる事象 |
| **Try** | 試したいこと（質より量） | 改善につながりそうなアイデア（実現可能性は問わず列挙） |
| **Action** | 行動すること | Try の中から次のセッションで確実に実行できる具体的な施策 |

#### 各項目の整理フォーマット

Problem と Action の各項目を以下のフォーマットで整理する（Keep と Try は箇条書きで十分）。Problem は「責める」のではなく「再現条件を探す」姿勢で記述する:

```
### [P-N] <タイトル>

- **状況**: いつ・どこで・どのような出来事が起こったか
- **問題**: 具体的に何が・どのようになってしまったか
- **期待**: 何が・どのような状態であれば解決と言えるか
- **原因**: 何を・どのような状況にすると問題を再現できるか
- **対策**: 現実的かどうかに関わらず考えられる解決策
- **評価**: 望んだ結果にするためにどの対策が有効か
```

Action は「今すぐできる」「誰が見ても明確」な粒度に絞る。Try は量を重視して列挙する。

---

### Step 3: 改善提案を生成する

Problem から導出した Action を実現するための、具体的な改善提案を検討する。

#### 改善対象の優先順位

1. **Claude Code スキル**: 既存スキルの修正、新スキルの追加
2. **Claude Code 設定**: CLAUDE.md・hooks・keybindings の変更
3. **プロジェクトのリンター・フォーマッター**: ESLint, Biome, Prettier, oxlint など
4. **CLIツールの活用**: `~/Documents/MY/dotfiles/docs/tools/README.md` に記載されたツールで対応できるものがないか確認する

各改善提案には以下を明記する:

```
#### [改善提案-N] <タイトル>

- **対象**: スキル / CLAUDE.md / hooks / keybindings / リンター / CLIツール
- **対象ファイル・スキル名**: <具体的なパスやスキル名>
- **内容**: 何をどう変更・追加するか
- **期待効果**: この改善によって何が変わるか
- **Action への対応**: [A-N] に対応
```

---

### Step 4: Retrospective.md に記録する

日付を取得する:

```bash
date +%Y-%m-%d
```

プロジェクトルート（`CLAUDE_PROJECT_DIR` またはカレントディレクトリ）の `Retrospective.md` に記録する。

既存の `Retrospective.md` がある場合は、新しいセッションのふりかえりを**先頭に追記**する（過去の記録を保持する）。

#### ファイルフォーマット

```markdown
# Retrospective

<!-- このファイルはGit管理されますが、コミット・プッシュは禁止です -->

---

## YYYY-MM-DD セッションのタイトル（主なテーマを一言で）

### セッションサマリー

<Step 1 で作成したサマリー>

---

### Keep（続けること）

- <箇条書き>

---

### Problem（問題点）

<Step 2 の Problem 項目（状況・問題・期待・原因・対策・評価フォーマット）>

---

### Try（試したいこと）

- <箇条書き>

---

### Action（行動すること）

<Step 2 の Action 項目（状況・問題・期待・原因・対策・評価フォーマット）>

---

### 改善提案

<Step 3 の改善提案>

---
```

---

### Step 5: 改善提案の実施を提案する

Retrospective.md に記録後、改善提案の中に**すぐに実施できるもの**があれば、ユーザーに実施を提案する。

AskUserQuestion で確認する:

```json
{
  "question": "改善提案の中で、このセッション中に実施するものを選んでください",
  "options": [
    { "label": "実施する", "description": "どの提案を実施するか選んで今すぐ実装する" },
    { "label": "スキップ", "description": "次回以降に持ち越す" }
  ]
}
```

「実施する」が選択された場合、どの提案から着手するかを確認し、実施する。

---

## 注意事項

- `Retrospective.md` はコミット・プッシュ禁止（bash-guard.sh が強制ブロック）
- 会話履歴全体がふりかえりの素材。抜け漏れのないよう丁寧に振り返る
- Keep は継続・強化すべき点を積極的に探す（改善だけでなく良い点の言語化も重要）
- Problem は責めるのではなく「再現条件を探す」姿勢で記述する
- Action は「今すぐできる」「誰が見ても明確」な粒度に絞る
- Try は量を重視し、実現可能性を問わず列挙する

# fzf

汎用のあいまい検索ツール。標準入力から受け取った任意のリストに対して、インタラクティブに絞り込み検索ができる。fzf自体は「検索UI」であり、何を検索するかはパイプで渡す側が決める設計のため、あらゆるCLIワークフローに組み込める。

## インストール

```bash
brew install fzf
```

`Brewfile`で管理。

## 基本的な使い方

```bash
# コマンド履歴をあいまい検索（Ctrl+R）
# ※ fzfインストール後、シェルに自動統合される

# ファイルをインタラクティブに検索
find . | fzf

# ブランチを選択
git branch | fzf

# プレビュー付きでファイルを検索
fzf --preview 'cat {}'

# 複数選択を有効にする
fzf --multi
```

## 主要オプション

### 検索

| オプション | 説明 |
|---|---|
| `-e, --exact` | 完全一致モード（あいまいマッチを無効化） |
| `-i, --ignore-case` | 大文字小文字を区別しない |
| `+i, --no-ignore-case` | 大文字小文字を区別する |
| `--smart-case` | スマートケース（デフォルト） |
| `-n, --nth=N[,..]` | 検索対象のフィールドを限定（例: `-n1`で1番目のフィールドのみ） |
| `-d, --delimiter=STR` | フィールド区切り文字（デフォルト: AWK準拠の空白） |

### フィルター・選択

| オプション | 説明 |
|---|---|
| `-m, --multi` | Tab/Shift-Tabで複数選択を有効にする |
| `-q, --query=STR` | 初期クエリを指定して起動 |
| `-1, --select-1` | 結果が1件のみなら自動選択 |
| `-0, --exit-0` | 結果が0件なら即終了 |
| `-f, --filter=STR` | 非インタラクティブにフィルターして結果を出力 |
| `--tac` | 入力を逆順にする |

### 表示・レイアウト

| オプション | 説明 |
|---|---|
| `--height=[~]HEIGHT[%]` | 全画面ではなく指定高さで表示（`~`で入力量に応じて自動調整） |
| `--layout=LAYOUT` | レイアウト（`default`, `reverse`, `reverse-list`） |
| `--border[=STYLE]` | 枠線を表示 |
| `--prompt=STR` | プロンプト文字列（デフォルト: `> `） |
| `--header=STR` | ヘッダー文字列を表示 |
| `--header-lines=N` | 入力の先頭N行をヘッダーとして扱う |
| `--ansi` | ANSI カラーコードを処理する |
| `--cycle` | リストの末尾から先頭へ循環スクロール |

### プレビュー

| オプション | 説明 |
|---|---|
| `--preview=COMMAND` | 選択中の項目をプレビューするコマンド（`{}`がパスに展開される） |
| `--preview-window=OPT` | プレビューウィンドウの配置（`up\|down\|left\|right`, サイズ%, `hidden`等） |

### キーバインド

| オプション | 説明 |
|---|---|
| `--bind=BINDINGS` | カスタムキーバインドを定義 |
| `--expect=KEYS` | 押されたキーを先頭行に出力（スクリプト向け） |

### 環境変数

| 変数 | 説明 |
|---|---|
| `FZF_DEFAULT_COMMAND` | 入力がttyの場合に使うデフォルトコマンド |
| `FZF_DEFAULT_OPTS` | デフォルトオプション（例: `--layout=reverse --height=40%`） |

### シェル統合（デフォルトのキーバインド）

| キー | 機能 |
|---|---|
| `Ctrl+R` | コマンド履歴をあいまい検索 |
| `Ctrl+T` | ファイル・ディレクトリーをあいまい検索してコマンドラインに挿入 |
| `Alt+C` | ディレクトリーをあいまい検索してcd |

## ユースケース

### fdと組み合わせてファイルを高速検索する

```bash
fd --type f | fzf
```

fdの高速なファイル列挙とfzfのインタラクティブな絞り込みを組み合わせて、大規模プロジェクトでも快適にファイルを探せる。

### プレビュー付きでファイルを選択する

```bash
fzf --preview 'bat --color=always {}'
```

ファイル選択時にシンタックスハイライト付きのプレビューを表示する。`bat`の代わりに`cat`でも可。

### gitブランチを選択してチェックアウトする

```bash
git branch | fzf | xargs git checkout
```

ブランチ名をあいまい検索で絞り込み、そのままチェックアウトできる。

### 複数ファイルを選択して一括操作する

```bash
fd -e ts | fzf --multi | xargs code
```

`--multi`（Tab/Shift-Tabで選択）で複数ファイルを選び、まとめてエディターで開く。

### 特定のフィールドだけを検索対象にする

```bash
ps aux | fzf --header-lines=1 -n11 --preview 'echo {}'
```

`--header-lines=1`で先頭行をヘッダーとして固定し、`-n11`で11番目のフィールド（コマンド名）だけを検索対象にする。プロセスの選択に便利。

### 非インタラクティブにフィルターする

```bash
echo -e "apple\nbanana\norange" | fzf -f "an"
```

`-f`でインタラクティブUIを開かずにフィルター結果を出力する。スクリプト内での利用に使える。

### 初期クエリ付きで起動する

```bash
fd --type f | fzf -q ".ts$"
```

`-q`で初期クエリを指定した状態でインタラクティブUIを開く。さらに絞り込みたい場合に便利。

### キーバインドで追加アクションを実行する

```bash
fzf --preview 'bat --color=always {}' \
    --bind 'ctrl-y:execute-silent(pbcopy < {})' \
    --bind 'ctrl-e:execute(code {})'
```

`--bind`で選択中の項目に対して任意のアクションを割り当てられる。この例ではCtrl+Yでクリップボードにコピー、Ctrl+Eでエディターで開く。

## 参考リンク

- [GitHub - junegunn/fzf](https://github.com/junegunn/fzf)
